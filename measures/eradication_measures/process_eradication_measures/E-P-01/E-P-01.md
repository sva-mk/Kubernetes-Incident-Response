# E-P-01 Process Eradication by Updating Applications

Fundamentally, all artifacts of an attack must be removed [[Tho18, p.117](https://link.springer.com/book/10.1007/978-1-4842-3870-7)]. The specific manifestation of these artifacts in the context of a compromised cluster can vary greatly [[Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/)]. In the attack scenario under consideration, malware is executed in one of the pods in various ways to gain initial access and subsequently escalate the attackers' privileges. The processes executed and files left behind are therefore artifacts that must be removed [[Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/)].

In the context of traditionally operated applications, this often requires a complete rebuild of the entire software system, as the application is run directly on the operating system [[Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/); [MPM14, p.615](http://cisweb.bristolcc.edu/~ik/Download/Forensic/Incident_Response_Computer_Forensics_3rd_Edition.pdf)]. Similarly, in virtualized application environments, the entire application environment is renewed by replacing and reconfiguring the associated VMs [[Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/)]. In this process, new VMs are created based on a so-called "Golden Image" [[Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/)], which are then used to build the updated application. Necessary application software updates are usually integrated by installing a newer version of the application [[Tho18, p.117](https://link.springer.com/book/10.1007/978-1-4842-3870-7)].

For containerized applications, as used with Kubernetes, the container images already contain the complete application, so in connection with the principle of "Stateless Applications" [[Clo23b](https://glossary.cncf.io/stateless-apps/)], it is sufficient to replace the compromised containers with new ones to remove artifacts, provided no persistent storage areas are assigned [[Ama23a](https://aws.github.io/aws-eks-best-practices/security/docs/incidents/)]. However, before replacing the containers, the underlying container image must be updated to prevent another compromise [[Ama23a](https://aws.github.io/aws-eks-best-practices/security/docs/incidents/); [Joh22d](https://learning.oreilly.com/library/view/digital-forensics-and/9781803238678/); [MPM14, pp.614ff](http://cisweb.bristolcc.edu/~ik/Download/Forensic/Incident_Response_Computer_Forensics_3rd_Edition.pdf)]. An update, including the replacement of the containers, can be carried out in Kubernetes following this procedure:

1. Configuration of the Update Strategy [[The23p](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)]
   - Currently, the pods of an application in Kubernetes can either be updated all at once (Recreate) or updated incrementally (RollingUpdate). In a production environment, the latter is recommended, where the number of pods deviating from the defined count during the update process can be explicitly specified [[The24y](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/); [The23p](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)].
   - Typically, an update strategy is configured in advance, but in the context of an incident, it should be reviewed or adjusted. An example configuration of the update strategy can be found in the official documentation [[The23p](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)].

2. Update of the Application Definition (see Listing 1 line 1) [[The24y](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/)].
   - Using the command in line 1, the container image of the pods associated with a deployment can be modified as needed. The update is then handled by the control plane.
   - The updated version, including the respective security updates, can be found in the application's documentation.

3. Verification of the update's success (see Listing 1 line 2) [[The24y](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/)].
   - If the update is not successful, new pods with the previous version can be created using the command in line 3 [[The24y](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/)].

##### Listing 1: Commands for updating applications based on deployments according to [[The24y](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/); [The23p](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)]

```bash
kubectl set image deployments/<deployment-name> <container-name>=<container-image>:<version>
kubectl rollout status deployments/<deployment-name>
kubectl rollout undo deployments/<deployment-name>
```

## Evaluation

The following table, entitled *Evaluation of measure E-P-01*, provides an overview of the evaluation of the aforementioned measure. The composition of the overall rating is then described in detail.

#### Table: Evaluation of E-P-01

| Criteria           | Result |
| ------------------ | ------ |
| Applicability      | 5      |
| Preparation Effort | 5      |
| Complexity         | 4      |
| Coverage           | 3      |
| Business Impact    | 5      |
| Visibility         | 2      |
| Resilience         | 4      |
| Reproducibility    | 5      |
| Interoperability   | 3      |
| Overall Rating     | 4,30   |

In general, to evaluate the measure, the version of the web server was updated in the experimental environment, and the results were documented. In doing so, the measure demonstrated very high applicability (5) and equally high reproducibility (5), as identical results were obtained in every test scenario and in all five iterations. However, the results show only moderate interoperability (3), as they can only be output in text form [[The24w](https://kubernetes.io/docs/reference/kubectl/generated/kubectl_rollout/kubectl_rollout_status/)]. Regardless, the preparation effort for the measure is very low (5), as only the configuration of the update strategy needs to be carried out beforehand. The measure has low complexity (4), as minimal expertise is required to perform the three steps.
Additionally, the business impact of this measure is very low (5), as the application remains fully available during the update due to the standard use of a rolling update.

But the visibility of the measure is very high (1), as all contexts of the compromised pods are changed by the update. Additionally, the resilience of the measure is high (4), as attackers would need to find and successfully exploit a new vulnerability in the application before regaining access to the pods, which requires a high level of expertise [[pop23](https://popalltheshells.medium.com/hunting-0days-for-a-better-world-7b25dafc70a0)]. Furthermore, the measure is capable of preventing attackers from gaining initial access to the cluster and exploiting it for their advantage. Therefore, the measure has a moderate coverage (3) and was rated overall with 4.30.

##### Figure 1: Business impact of measure E-P-01
![Business impact of measure E-P-01](Dependency-Modeling-Diagram_E-P-01.png)
