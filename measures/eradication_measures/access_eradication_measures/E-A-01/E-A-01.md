# E-A-01 Access Eradication by Removing Unauthorized Service Accounts

In the eradication phase, it is essential to remove every known means of authentication that attackers could use to access the affected system [[MPM14, p. 613](http://cisweb.bristolcc.edu/~ik/Download/Forensic/Incident_Response_Computer_Forensics_3rd_Edition.pdf)]. This includes not only typical measures like assigning new passwords or enabling two-factor authentication methods [[MPM14, p. 613](http://cisweb.bristolcc.edu/~ik/Download/Forensic/Incident_Response_Computer_Forensics_3rd_Edition.pdf)], but also involves removing any user accounts created by attackers during the incident to prevent long-term access to the system [[Cic+12, p. 37](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf); [The23aw](https://attack.mitre.org/techniques/T1136/)].

In the Kubernetes environment user accounts cannot be created. Instead, only ServiceAccounts can be defined. These were originally intended for the authentication of Kubernetes components but can also be exploited by attackers as an authentication method. Therefore, during the eradication phase, all ServiceAccounts not created by the organization must be removed. The following procedure can be used for this purpose:

1. **Identify all unauthorized ServiceAccounts in the cluster** (see Listing 1 line 1) [[The24u](https://kubernetes.io/docs/reference/kubectl/quick-reference/)].
   - Generally, any ServiceAccounts associated with the attackers should be removed, or their associated ServiceAccount tokens should be renewed. Additionally, it is recommended to verify that all ServiceAccounts only have the necessary permissions, though this is not elaborated further here.

2. **Remove the unauthorized ServiceAccounts** (see Listing 1 line 2) [[The24u](https://kubernetes.io/docs/reference/kubectl/quick-reference/); [The23ao](https://kubernetes.io/docs/concepts/security/service-accounts/)].

3. **Verify the successful removal** (see Listing 1 line 3) [[The24u](https://kubernetes.io/docs/reference/kubectl/quick-reference/)].
   - For particularly relevant ServiceAccounts, such as those with administrative rights or those repeatedly used during the incident, it is advisable to verify that authentication with the respective ServiceAccount is no longer possible.

##### Listing 1: Commands for removing unauthorised ServiceAccounts according to [[The24u](https://kubernetes.io/docs/reference/kubectl/quick-reference/); [The23ao](https://kubernetes.io/docs/concepts/security/service-accounts/)]

```bash
kubectl get serviceaccounts --all-namespaces
kubectl delete serviceaccounts -n <namespace> <serviceaccount-name>
kubectl get serviceaccounts --all-namespaces | grep <serviceaccount-name>
```

## Evaluation

The following table, entitled *Evaluation of measure E-A-01*, provides an overview of the evaluation of the aforementioned measure. The composition of the overall rating is then described in detail.

#### Table: Evaluation of E-A-01

| Criteria           | Result |
| ------------------ | ------ |
| Applicability      | 5      |
| Preparation Effort | 5      |
| Complexity         | 3      |
| Coverage           | 4      |
| Business Impact    | 5      |
| Visibility         | 4      |
| Resilience         | 2      |
| Reproducibility    | 5      |
| Interoperability   | 3      |
| Overall Rating     | 4,25   |

In general, the evaluation of the measure in the experimental environment was carried out according to the aforementioned guidelines. A very high applicability (5) and a very high reproducibility (5) were observed, as the measure was successfully executed multiple times in the four test scenarios with identical results. The interoperability of the results is only satisfactory (3), as the presented method only outputs results in text form, which can then be further processed with tools like `grep`. At the same time, the business impact and the preparation effort of the measure are very low (5), since, with correct identification of the unauthorized ServiceAccounts, none of the organization's applications are affected (see Figure 1), and no additional preparations are necessary as all required functions are directly integrated into the Kubernetes API. The visibility of the measure is relatively low (4) because the unauthorized ServiceAccounts are removed, which alters the storage context of the cluster.

The complexity of this measure is rated as satisfactory (3), as only three actions are required, but the identification of unauthorized ServiceAccounts does require some expertise. The resilience of the measure is also low (2), as attackers can potentially extract the ServiceAccount token from a compromised pod to continue authenticating with a legitimate ServiceAccount. In this case, however, it is sufficient to restart all pods one by one, as this invalidates the respective ServiceAccount tokens [[The23ab](https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/)]. The coverage of the measure is high (4), as it prevents access to the cluster via the ServiceAccount, addressing TTPs T1528 [[The23bd](https://attack.mitre.org/techniques/T1528/)], T1613 [[The23au](https://attack.mitre.org/techniques/T1613/)], T1069 [[The23ba](https://attack.mitre.org/techniques/T1069/)], and T1136 [[The23aw](https://attack.mitre.org/techniques/T1136/)].

Overall, the measure was rated 4.25.

##### Figure 1: Business impact of measure E-A-01
![Business impact of measure E-A-01](Dependency-Modeling-Diagram_E-A-01.png)